"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},a=!1){return BOXCoin.ajax(t,e,a)}function a(t,e=!0){return BOXCoin.activate(t,e)}function n(t,e=!1){S.card(t,e)}function i(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function c(t,e=!1){S.error(t,e)}function r(t,e=-1){return t&&U(t).e.length?(t=U(t).e[0],-1===e?U(t).is("checkbox")?t.checked:t.value.trim():(U(t).is("checkbox")?t.checked=0!=e&&e:t.value=e,void(U(t).is("textarea")&&h(t)))):""}function o(t){return U(t).find("input, select, textarea")}function s(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.includes("?")&&(e=e.substr(0,e.indexOf("?"))),e.length>1){let t=x.find(".bxc-nav "+e);if(t.length)return d(t),!0}}return!1}function d(n){if(!U(n).e.length)return;let i=x.find("main > div"),c=n.index();switch(k=U(i.e[c]),g=n.attr("id"),x.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+g),a(i,!1),a(n.siblings(),!1),a(n),a(k),window.location.href.includes(g)||window.history.pushState("","","#"+g),g){case"transactions":t(k)||(t(k),B=0,C.find("tbody").html(""),D.print(()=>{t(i.e[c],!1)}));break;case"checkouts":k.hasClass("bxc-loading")&&e("get-checkouts",{},e=>{let a="";O=e;for(var n=0;n<e.length;n++)a+=T.row(e[n]);u(x.find("#bxc-table-checkouts tbody"),a),t(i.e[c],!1)});break;case"balances":S.balance(k);break;case"settings":k.hasClass("bxc-loading")&&e("get-settings",{},e=>{let a="";if(e){k.find(".bxc-btn-repater").e.forEach(t=>{let n=2;for(;t.parentElement.firstChild.id+"-"+n in e;)a+=f(t,!1,n),n++;a&&(a+=t.outerHTML.replace('"2"','"'+n+'"'),U(t).parent().append(a),t.remove())});for(var n in e){let t=x.find(`#${n}`);t&&r(o(t),e[n])}k.find("#btc-wallet-key input, #eth-wallet-key input, #ln-macaroon input").e.forEach(t=>{t.value&&(t.value="********")})}t(i.e[c],!1)})}}function l(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}function u(t,e,a=!1){if(!e)return!t.html()&&t.html(`<p class="bxc-not-found">${i("There's nothing here yet.")}</p>`);t.find(".bxc-not-found").remove(),t.html((a?t.html():"")+e)}function b(){h(this)}function h(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"}function f(t,e=!0,a=!1){let n=U(t).parent(),i=n.find("[data-type], hr"),c='<div class="bxc-repater-line"><hr /><i class="bxc-icon-close"></i></div>';a=a||parseInt(U(t).data("index"));for(var r=0;r<i.e.length&&"HR"!=i.e[r].nodeName;r++){let t=U(i.e[r]).attr("id");c+=i.e[r].outerHTML.replace(t,t+"-"+a)}if(!e)return c;c+=t.outerHTML.replace('"'+a+'"','"'+(a+1)+'"'),t.remove(),n.append(c)}var p,x,m,v,k,g,C,y,w,$=[!1,!1,!1,!1],_={P:"Pending",C:"Completed",R:"Refunded",X:"Underpayment"},B=0,X=!0,R=new Date,O=!1,L=window.innerWidth<769,N=!1,U=window._query,D={get:function(t,a=!1,n=!1,i=!1,c=!1){e("get-transactions",{pagination:B,search:a,status:n,cryptocurrency:i,date_range:c},e=>{B++,t(e)})},print:function(t,e=$[0],a=$[1],n=$[2],c=$[3]){this.get(e=>{let a="";X=e.length;for(var n=0;n<X;n++){let t=e[n],r=t.from?`<a href="${S.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"",o=t.currency.toUpperCase()+" "+t.amount_fiat,s="",d=t.description.replace(/\[|\]|"/g,""),u=["","","","","",""];if(L){u=["ID","Date","From","To","Status","Amount"];for(var c=0;c<u.length;c++)u[c]='<div class="bxc-label">'+i(u[c])+"</div>"}t.vat_details&&(s=JSON.parse(t.vat_details),s=` data-vat="${t.currency} ${s.amount} (${s.percentage}%, ${s.country})"`),a+=`<tr data-id="${t.id}" data-title="${t.title}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}" data-notes="${d.replace(/,/g,"<br>")}" data-status="${t.status}"${t.billing?' data-invoice="true"':""}${s}><td class="bxc-td-id">${u[0]}${t.id}</td><td class="bxc-td-time">${u[1]}<div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-from">${r?u[2]:""}${r}</td><td class="bxc-td-to">${t.to?u[3]:""}${t.to?`<a href="${S.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a>`:""}</td><td class="bxc-td-status">${u[4]}<span class="bxc-status-${t.status}">${i(_[t.status])}</span></td><td class="bxc-td-amount">${u[5]}<div class="bxc-title"><div>${t.amount?t.amount+" "+BOXCoin.baseCode(t.cryptocurrency.toUpperCase()):o}</div><div>${t.amount?o:l(BOXCoin.baseCode(t.cryptocurrency))}</div></div></td><td><i class="bxc-transaction-menu-btn bxc-icon-menu"></i></td></tr>`}u(C.find("tbody"),a,!0),t&&t(e)},e,a,n,c)},query:function(e=!1){t(C)||(C.find("tbody").html(""),B=0,$[0]=U(x).find("#bxc-search-transactions").val().toLowerCase().trim(),$[1]=U(x).find("#bxc-filter-status li.bxc-active").data("value"),$[2]=U(x).find("#bxc-filter-cryptocurrency li.bxc-active").data("value"),$[3]=!!N&&N.getDates("yyyy-mm-dd"),this.print(()=>{e&&t(e,!1),t(C,!1)}))},download:function(t){e("download-transactions",{search:$[0],status:$[1],cryptocurrency:$[2],date_range:$[3]},e=>{t(e)})}},T={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=y?3:2;for(var a=0;a<e;a++){let e=k.find("#bxc-checkout-"+(0==a?"payment-link":1==a?"embed-code":"shortcode")).find("div, i");if(t){let n=0==a?`${BXC_URL}pay.php?checkout_id=${t}${BXC_CLOUD.cloud?"&cloud="+BXC_CLOUD.cloud:""}`:1==a?`<div data-boxcoin="${t}"></div>${BXC_CLOUD.cloud?' <script id="boxcoin" src="'+BXC_URL+"js/client.js?cloud="+BXC_CLOUD.cloud+'"><\/script>':""}`:`[boxcoin id="${t}"]`;U(e.e[0]).html(n.replace(/</g,"&lt;")),U(e.e[1]).data("text",window.btoa(n))}else U(e.e[0]).html(""),U(e.e[1]).data("text","")}},get:function(t,e=!1){for(var a=0;a<O.length;a++)if(t==O[a].id)return e?(O.splice(a,1),!0):O[a];return!1}},S={active_element:!1,card:function(t,e=!1){var a=x.find(".bxc-info-card");a.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),e?"error"==e?a.addClass("bxc-info-card-error"):a.addClass("bxc-info-card-info"):clearTimeout(m),a.html(i(t)),m=setTimeout(()=>{a.html("")},5e3)},error:function(e,a=!1){window.scrollTo({top:0,behavior:"smooth"}),x.find(".bxc-info").html(e),a&&t(a,!1)},balance:function(a){if(!t(a)){let n=x.find("#bxc-table-balances tbody");if(!n.e.length)return;n.html()||a.addClass("bxc-loading-first"),e("get-balances",{},e=>{let i="",c=e.balances;x.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var r in c){i+=`<tr data-cryptocurrency="${r}"><td><div class="bxc-flex"><img src="${r in e.token_images?e.token_images[r]:`${BXC_URL}media/icon-${r}.svg`}" /> ${c[r].name}${BOXCoin.network(r)}</div></td><td><div class="bxc-balance bxc-title">${c[r].amount} ${BOXCoin.baseCode(r).toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${c[r].fiat}</div></td></tr>`}i?n.html(i):n.parent().html('<p class="bxc-text">Add your addresses from the Settings area.</p>'),a.removeClass("bxc-loading-first"),t(a,!1)})}},explorer:function(t,e,a="address"){let n="",i="address"==a?"address":["ltc","usdt_tron"].includes(t)?"transaction":"tx";switch(t){case"btc":n="https://www.blockchain.com/btc/{R}/{V}";break;case"eth":n="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":n="https://dogechain.info/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":n="https://etherscan.io/{R}/{V}"+("address"==a?"":"#tokentxns");break;case"usdt_tron":n="https://tronscan.org/#/{R}/{V}";break;case"algo":n="https://algoexplorer.io/{R}/{V}";break;case"stripe":n="https://dashboard.stripe.com/customers/{V}";break;case"verifone":n="https://secure.2checkout.com/cpanel/order_info.php?refno={V}";break;case"usdt_bsc":case"busd":case"bnb":n="https://bscscan.com/{R}/{V}";break;case"ltc":n="https://blockchair.com/litecoin/{R}/{V}";break;case"bch":n="https://www.blockchain.com/bch/{R}/{V}";break;case"xrp":i="address"==a?"accounts":"transactions",n="https://livenet.xrpl.org/{R}/{V}"}return n.replace("{R}",i).replace("{V}",e)}};window.BXCTransactions=D,window.BXCCheckout=T,window.BXCAdmin=S,document.addEventListener("DOMContentLoaded",()=>{if(p=U(document.body),(x=p.find(".bxc-main")).e.length){if(v=x.find("main > div"),k=v.e[0],C=x.find("#bxc-table-transactions"),y="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!x.hasClass("bxc-installation")){g="transactions",s()||D.print(()=>{t(k,!1)}),localStorage.getItem("bxc-cron")!=R.getDate()&&(e("cron",{domain:BXC_URL}),localStorage.setItem("bxc-cron",R.getDate()));let a=document.getElementsByTagName("textarea");for(let t=0;t<a.length;t++)a[t].setAttribute("style","height:"+a[t].scrollHeight+"px;overflow-y:hidden;"),a[t].addEventListener("input",b,!1);S.balance(x.find('main > [data-area="balance"]'))}C.on("click","tr",function(t){if(["A","I","LI"].includes(t.target.nodeName))return;let e=U(this).data("hash");if(e){let t=U(this).data("cryptocurrency"),a=S.explorer(t,e,"tx");a&&window.open(a)}}),x.on("click","#bxc-filters",function(){x.find(".bxc-nav-filters").toggleClass("bxc-active")}),x.on("click","#bxc-filter-date,#bxc-filter-date-2",function(){let t={maxNumberOfDates:2,maxDate:new Date,dateDelimiter:" - ",clearBtn:!0};N||(U.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),U.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(t.language=BXC_LANG,U.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{(N=new DateRangePicker(U(this).parent().e[0],t)).datepickers[0].show()})):(N=new DateRangePicker(U(this).parent().e[0],t)).datepickers[0].show()}))}),x.on("click","#bxc-filter-status li,#bxc-filter-cryptocurrency li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{D.query()},100)}),x.on("click","#bxc-download-transitions",function(){t(this)||D.download(e=>{window.open(e),t(this,!1)})}),C.on("click",".bxc-transaction-menu-btn:not(.bxc-loading)",function(){let t=U(this).hasClass("bxc-active"),e=U(this.closest("tr")),n=`<ul class="bxc-transaction-menu bxc-ul"><li data-value="details">${i("Details")}</li>`,c=e.data("status"),r=e.data("cryptocurrency");if(a(C.find(".bxc-transaction-menu-btn"),!1),C.find(".bxc-transaction-menu").remove(),!t){a(this),e.data("invoice")&&"C"==c&&(n+=`<li data-value="invoice">${i("Invoice")}</li>`),"P"==c&&(n+=`<li data-value="payment-link">${i("Payment link")}</li>`),["C","X"].includes(c)&&(BXC_REFUNDS.includes("coinbase")&&["btc","eth","xrp","usdt","usdc","busd","bnb","link","doge","shib","ltc","algo","bat","bch"].includes(r)||BXC_REFUNDS.includes("btc")&&"btc"==r||BXC_REFUNDS.includes("eth")&&["eth","usdt","usdc","link","shib","bat"].includes(r))&&(n+=`<li data-value="refund">${i("Issue a refund")}</li>`);for(var o in _)o!=c&&(n+=`<li data-value="${o}">${i("Mark as "+_[o].toLowerCase())}</li>`);U(this).parent().append(n+"</ul>")}}),C.on("click",".bxc-transaction-menu li",function(){let c=U(this.closest("tr")),r=c.find(".bxc-transaction-menu-btn");if(t(r))return;let o=U(this).data("value"),s=c.data("id");if(["C","P","R"].includes(o)&&e("update-transaction",{transaction_id:s,values:{status:o}},()=>{c.data("status",o).find(".bxc-td-status span").attr("class","bxc-status-"+o).html(i(_[o])),t(r,!1)}),"invoice"!=o&&"payment-link"!=o||e(o,{transaction_id:s},e=>{window.open(e),t(r,!1)}),"details"==o){let e='<div class="bxc-text-list bxc-transaction-details-list">',a=[["ID","id"],["Checkout","data-title"],["Hash","data-hash"],["Time","time"],["Notes","data-notes"],["Status","status"],["From","from"],["To","to"],["Amount","amount"],["VAT","data-vat"]];for(var d=0;d<a.length;d++){let t=a[d][1],n=t.includes("data")?c.attr(t):c.find(".bxc-td-"+t).html();n&&("data-hash"==t&&(n=`<a href="${S.explorer(c.data("cryptocurrency"),n,"tx")}" target="_blank">${n}</a>`),e+=`<div><div>${i(a[d][0])}</div><div>${n}</div></div>`)}BOXCoin.lightbox("Transaction details",e),t(r,!1)}"refund"==o&&(n(i("Sending refund in 5 seconds.")+' <span id="cancel-refund">Cancel</span>',"info"),w=setTimeout(()=>{e(o,{transaction_id:s},e=>{if(!0===e.status){c.data("status",o).find(".bxc-td-status span").attr("class","bxc-status-R").html(i(_.R)),n(e.message);let t=x.find(".bxc-info-card a");t.attr("href",S.explorer(c.data("cryptocurrency"),t.data("hash"),"tx"))}else n(e.message,"error");t(r,!1)})},5e3)),c.find(".bxc-ul").remove(),a(r,!1)}),x.on("click","#cancel-refund",function(){clearTimeout(w),t(C.find(".bxc-loading"),!1)}),x.on("click","#bxc-request-payment",function(){let t="",e=[["price","Price","number"],["currency","Currency code","text"],["pay","Cryptocurrency code","text"],["redirect","Redirect URL","url"],["note","Notes","text"]];for(var a=0;a<e.length;a++)t+=`<div class="bxc-input"><span>${i(e[a][1])}</span><input data-url-attribute="${i(e[a][0])}" type="${i(e[a][2])}"></div>`;BOXCoin.lightbox("Create a payment request",t+`<div id="bxc-create-payment-link" class="bxc-btn">${i("Create payment link")}</div>`)}),p.on("click","#bxc-create-payment-link",function(){let t=U(this).parent().find("input").e,e="";for(var a=0;a<t.length;a++){let n=U(t[a]).data("url-attribute"),i=U(t[a]).val();i&&("redirect"==n&&(i=encodeURIComponent(i)),"note"==n&&(i=window.btoa(i)),e+="&"+n+"="+i)}e&&(e=`${BXC_URL}pay.php?checkout_id=custom-${Math.floor(Date.now()/1e3)}${BXC_CLOUD.cloud?"&cloud="+BXC_CLOUD.cloud:""}${e}`,U(this).parent().find("#bxc-payment-request-url-box").remove(),U(this).insert(`<div id="bxc-payment-request-url-box" class="bxc-input"><a href="${e}" target="_blank">${e.replace(/&/g,"&amp")}</a><i class="bxc-icon-copy bxc-clipboard" data-text="${window.btoa(e)}"></i></div>`))}),x.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){if(x.addClass("bxc-area-create-checkout"),U(this).is("td")){let e=U(this).parent().data("checkout-id"),a=T.get(e);k.data("checkout-id",e);for(var t in a){r(o(k.find(`#bxc-checkout-${t}`)),a[t])}T.embed(e)}else o(k).e.forEach(t=>{r(t,"")}),k.find("#bxc-checkout-type select").val("I"),k.data("checkout-id",""),T.embed()}),x.on("click","#bxc-checkouts-list",function(){x.removeClass("bxc-area-create-checkout"),k.data("checkout-id","")}),x.on("click","#bxc-save-checkout",function(){if(t(this))return;let a=!1,i={},o=k.find(".bxc-input"),s=k.data("checkout-id");x.find(".bxc-info").html(""),o.removeClass("bxc-error"),o.e.forEach(t=>{let e=U(t).attr("id"),n=U(t).find("input, select"),c=r(n);!c&&n.e.length&&n.e[0].hasAttribute("required")&&(a=!0,U(t).addClass("bxc-error")),i[e.replace("bxc-checkout-","")]=c}),a?c("Fields in red are required.",this):(s&&(i.id=s),e("save-checkout",{checkout:JSON.stringify(i)},e=>{t(this,!1),Number.isInteger(e)?(i.id=e,k.data("checkout-id",e),k.find("#bxc-table-checkouts tbody").append(T.row(i)),T.embed(e),O.push(i),n("Checkout saved successfully")):!0===e?(T.get(s,!0),O.push(i),k.find(`tr[data-checkout-id="${s}"]`).replace(T.row(i)),n("Checkout saved successfully")):c(e,this.closest("form"))}))}),x.on("click","#bxc-delete-checkout",function(){if(t(this))return;let a=k.data("checkout-id");e("delete-checkout",{checkout_id:a},()=>{t(this,!1),k.data("checkout-id",""),k.find(`tr[data-checkout-id="${a}"]`).remove(),k.find("#bxc-checkouts-list").e[0].click(),n("Checkout deleted","error")})}),x.on("click","#bxc-save-settings",function(){if(t(this))return;let a={};x.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{a[U(t).attr("id")]=r(o(t))}),e("save-settings",{settings:JSON.stringify(a)},e=>{n(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),x.on("click","#update-btn a",function(a){if(!t(this))return e("update",{domain:BXC_URL},e=>{t(this,!1);let a=!1,i=!0;if("string"==typeof e)n(l(e),"error");else{for(var c in e)!0!==e[c]&&"latest-version-installed"!==e[c]?a=!0:!0===e[c]&&(i=!1);i?n("You have the latest version!"):a?n(l(JSON.stringify(e)),"error"):(n("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500))}}),a.preventDefault(),!1}),x.on("click","#email-test-btn a",function(a){if(!t(this))return e("email-test",{},e=>{n(!0===e?"Email successfully sent.":e),t(this,!1)}),a.preventDefault(),!1}),x.on("click",".bxc-btn-repater",function(){f(this)}),x.on("click",".bxc-repater-line i",function(){let t=U(this).parent(),e=Array.from(t.parent().e[0].childNodes),a=e.indexOf(t.e[0])+1,n=t.parent().find(".bxc-btn-repater");for(var i=a;i<e.length&&(!U(e[i]).hasClass("bxc-repater-line")&&!U(e[i]).hasClass("bxc-btn-repater"));i++)e[i].remove();n.data("index",parseInt(n.data("index"))-1),t.remove()}),L&&x.on("click",".bxc-icon-menu",function(){let t=U(this).parent();a(t,!t.hasClass("bxc-active"))}),x.on("click","#bxc-submit-installation",function(){if(t(this))return;let a=!1,n={},i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),r=x.find(".bxc-input");if(r.removeClass("bxc-error"),x.find(".bxc-info").html(""),r.e.forEach(t=>{let e=U(t).attr("id"),i=U(t).find("input"),c=i.val().trim();!c&&i.e[0].hasAttribute("required")&&(a=!0,U(t).addClass("bxc-error")),n[e]=c}),a){a="Username, password and the database details are required.";let t=n.password;return t&&(t.length<8?a="Minimum password length is 8 characters.":t!=n["password-check"]&&(a="The passwords do not match.")),void c(a,this)}i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),n.url=i+"/",e("installation",{installation_data:JSON.stringify(n)},t=>{!0===t?location.reload():c(t,this)})}),x.on("click",".bxc-nav > div",function(){d(U(this))}),x.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:x.find("#username input").val().trim(),password:x.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(x.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),x.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),BOXCoin.cookie("BXC_CLOUD",!1,!1,"delete"),location.reload()}),x.on("click","#bxc-card",function(){U(this).html("")}),x.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==g&&D.query(e,t)})}),x.on("click","#bxc-table-balances tr",function(){let t=U(this).data("cryptocurrency"),e=S.explorer(t,BXC_ADDRESS[t]);e&&window.open(e)}),window.onscroll=function(){k&&(document.documentElement||document.body.parentNode||document.body).scrollTop+window.innerHeight==U.documentHeight()&&X&&"transactions"==g&&(U(k).find("> .bxc-loading-global").e.length||(D.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),U(k).find("> .bxc-loading-global").remove()}),U(k).append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){s()},document.addEventListener("click",function(t){S.active_element&&!S.active_element.contains(t.target)&&(a(S.active_element,!1),S.active_element=!1)})}})}();